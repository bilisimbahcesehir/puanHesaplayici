<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>GeliÅŸmiÅŸ AÄŸÄ±rlÄ±klÄ± Not Hesaplama</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f6f8;
            padding: 15px;
        }
        h1 { text-align: center; }
        .container {
            max-width: 800px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }
        input, button {
            padding: 8px;
            flex: 1;
            min-width: 120px;
        }
        input:invalid { border: 2px solid red; }
        button { cursor: pointer; }
        .btn-edit { background:#1976d2; color:white; border:none; }
        .btn-delete { background:#8b0000; color:white; border:none; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .table-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        .result {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }
        .editing { background: #e3f2fd; }
        .avg-good { color: #2e7d32; }
        .avg-mid { color: #f9a825; }
        .avg-bad { color: #c62828; }
        @media (max-width: 600px) {
            table thead { display: none; }
            table, tbody, tr, td { display: block; width: 100%; }
            tr { margin-bottom: 15px; border: 1px solid #ccc; border-radius: 6px; }
            td {
                text-align: right;
                padding-left: 50%;
                position: relative;
                border: none;
                border-bottom: 1px solid #eee;
            }
            td::before {
                content: attr(data-label);
                position: absolute;
                left: 10px;
                width: 45%;
                padding-right: 10px;
                font-weight: bold;
                text-align: left;
            }
        }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>AÄŸÄ±rlÄ±klÄ± Not Hesaplama</h1>

    <div class="row">
        <input type="text" id="dersAdi" placeholder="Ders AdÄ±" required>
        <input type="number" id="dersSaati" placeholder="Ders Saati" min="1" max="10" required>
        <input type="number" id="dersNotu" placeholder="Puan (0-100)" min="0" max="100" required>
        <button onclick="dersEkle()">Ekle / GÃ¼ncelle</button>
    </div>

    <div class="table-wrapper">
    <table>
        <thead>
            <tr>
                <th>Ders</th>
                <th>Saat</th>
                <th>Puan</th>
                <th>AÄŸÄ±rlÄ±klÄ±</th>
                <th>Durum</th>
                <th>DÃ¼zenle</th>
                <th>Sil</th>
            </tr>
        </thead>
        <tbody id="dersListesi"></tbody>
    </table>
</div>

    <button style="margin-top:15px;width:100%" onclick="hesapla()">AÄŸÄ±rlÄ±klÄ± Ortalama Hesapla</button>
    <div class="result" id="sonuc"></div>
    <div class="result" id="uyari" style="color:red"></div>
</div>

<script>
    // âœ… HATA DÃœZELTÄ°LDÄ°: dersler doÄŸru ÅŸekilde baÅŸlatÄ±lÄ±yor
    let dersler = JSON.parse(localStorage.getItem('dersler')) || [];
    let duzenlenenIndex = null;

    function harfNotu(notu) {
        if (notu >= 85) return 'Pekiyi';
        if (notu >= 70) return 'Ä°yi';
        if (notu >= 60) return 'Orta';
        if (notu >= 50) return 'GeÃ§er';
        return 'GeÃ§mez';
    }

    function dersEkle() {
        const ad = dersAdi.value.trim();
        const saat = Number(dersSaati.value);
        const puan = Number(dersNotu.value);

        if (!ad || dersSaati.value === '' || dersNotu.value === '') {
            alert('Ders adÄ±, ders saati ve puan alanlarÄ± zorunludur');
            return;
        }

        if (saat < 1 || saat > 10 || puan < 0 || puan > 100) {
            alert('Ders saati 1-10 arasÄ±nda, puan 0-100 arasÄ±nda olmalÄ±dÄ±r');
            return;
        }

        // ğŸ”’ AynÄ± ders adÄ± kontrolÃ¼
        const ayniDersVar = dersler.some((d, i) => d.ad.toLowerCase() === ad.toLowerCase() && i !== duzenlenenIndex);
        if (ayniDersVar) {
            alert('Bu ders adÄ± zaten eklenmiÅŸ. AynÄ± ders iki kez girilemez.');
            return;
        }

        if (duzenlenenIndex !== null) {
            dersler[duzenlenenIndex] = { ad, saat, notu: puan };
            duzenlenenIndex = null;
        } else {
            dersler.push({ ad, saat, notu: puan });
        }

        kaydet();
        tabloGuncelle();
        dersAdi.value = dersSaati.value = dersNotu.value = '';
    }

    function duzenle(index) {
        duzenlenenIndex = index;
        tabloGuncelle();
        const d = dersler[index];
        dersAdi.value = d.ad;
        dersSaati.value = d.saat;
        dersNotu.value = d.notu;
    }

    function sil(index) {
        if (!confirm('Bu dersi silmek istediÄŸinize emin misiniz?')) return;
        dersler.splice(index, 1);
        kaydet();
        tabloGuncelle();
    }

    function tabloGuncelle() {
        const tbody = document.getElementById('dersListesi');
        tbody.innerHTML = '';

        // ğŸ”¤ Ders adÄ±na gÃ¶re alfabetik sÄ±ralama (TÃ¼rkÃ§e uyumlu)
        dersler.sort((a, b) => a.ad.localeCompare(b.ad, 'tr', { sensitivity: 'base' }));

        dersler.forEach((d, i) => {
            const agirlikli = d.saat * d.notu;
            const editingClass = (i === duzenlenenIndex) ? 'editing' : '';
            tbody.innerHTML += `
                <tr class="${editingClass}">
                    <td data-label="Ders">${d.ad}</td>
                    <td data-label="Saat">${d.saat}</td>
                    <td data-label="Puan">${d.notu}</td>
                    <td data-label="AÄŸÄ±rlÄ±klÄ±">${agirlikli}</td>
                    <td data-label="Durum">${harfNotu(d.notu)}</td>
                    <td data-label="DÃ¼zenle"><button class="btn-edit" onclick="duzenle(${i})">DÃ¼zenle</button></td>
                    <td data-label="Sil"><button class="btn-delete" onclick="sil(${i})">Sil</button></td>
                </tr>`;
        });
    }

    function hesapla() {
        let toplamAgirlikli = 0;
        let toplamSaat = 0;
        let gecmezSayisi = 0;

        dersler.forEach(d => {
            toplamAgirlikli += d.saat * d.notu;
            toplamSaat += d.saat;
            if (harfNotu(d.notu) === 'GeÃ§mez') gecmezSayisi++;
        });

        if (!toplamSaat) {
            alert('Ders ekleyin');
            return;
        }

        const ort = Number((toplamAgirlikli / toplamSaat).toFixed(2));
        sonuc.className = 'result';
        if (ort >= 85) sonuc.classList.add('avg-good');
        else if (ort >= 70) sonuc.classList.add('avg-mid');
        else sonuc.classList.add('avg-bad');
        sonuc.innerText = `AÄŸÄ±rlÄ±klÄ± Ortalama: ${ort}`;

        if (gecmezSayisi >= 4) {
            uyari.innerText = 'UYARI: 4 veya daha fazla dersten baÅŸarÄ±sÄ±z. SÄ±nÄ±f tekrarÄ±na kalÄ±r!';
            return;
        }

        if (ort >= 85) {
            uyari.innerText = 'ğŸ‰ Tebrikler! Takdir belgesi alabilirsiniz.';
        } else if (ort >= 70) {
            uyari.innerText = 'ğŸ‘ Tebrikler! TeÅŸekkÃ¼r belgesi alabilirsiniz.';
        } else {
            uyari.innerText = '';
        }
    }

    function kaydet() {
        localStorage.setItem('dersler', JSON.stringify(dersler));
    }

    // Ä°lk yÃ¼klemede tabloyu doldur
    tabloGuncelle();
</script>

</body>
</html>
